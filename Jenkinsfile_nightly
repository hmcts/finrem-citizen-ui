#!groovy

properties([
  pipelineTriggers([cron('H 12 * * 1-5')]),
  parameters([
    string(name: 'URL_TO_TEST', defaultValue: 'https://finrem-citizen-ui.aat.platform.hmcts.net',
      description: 'The URL you want to run these tests against')
  ])
])

@Library("Infrastructure")

def type = "nodejs"
def product = "finrem"
def component = "citizen-ui"

withNightlyPipeline(type, product, component) {
  enableCrossBrowserTest()
  enableFullFunctionalTest()
  loadVaultSecrets(secrets)

  before('crossBrowserTest') {
    yarnBuilder.smokeTest()
  }

  afterAlways('crossBrowserTest') {
    steps.archiveArtifacts allowEmptyArchive: true, artifacts: 'functional-output/crossbrowser/reports/**/*'
  }

  afterAlways('fullFunctionalTest') {
    steps.archiveArtifacts allowEmptyArchive: true, artifacts: 'functional-output/functional/reports/**/*'
  }
}
